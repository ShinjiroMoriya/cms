$.ajaxSetup({beforeSend:function(a,b){function c(a){var b=null;if(document.cookie&&document.cookie!=''){var c=document.cookie.split(';');for(var d=0;d<c.length;d++){var e=jQuery.trim(c[d]);if(e.substring(0,a.length+1)==(a+'=')){b=decodeURIComponent(e.substring(a.length+1));break;}}}return b;}if(!(/^http:.*/.test(b.url)||/^https:.*/.test(b.url)))a.setRequestHeader('X-CSRFToken',c('csrftoken'));}});$('form').on('submit',function(){$(document).find('#loading').show();});$('body').append('<div id="loading" class="loading"></div>');$('.status_select').on('change',function(){var a=$(this).attr('data-lang');var b=$(this).attr('data-post_type');var c=$(this).attr('data-post_id');var d=$(this).val();if(b==='introduction')var e='/'+a+'/api/introductions/'+c+'/status';if(b==='video')var e='/'+a+'/api/videos/'+c+'/status';if(b==='topic')var e='/'+a+'/api/topics/'+c+'/status';$.ajax({type:'POST',url:e,cache:false,data:{'status':d},context:this}).done(function(a){$('.header_status_text').text('更新しました');$('.header_status').addClass('_show _success');}).fail(function(a){var b=a.responseJSON;if(a.status===503){$('.header_status_text').text(b.message);$('.header_status').addClass('_show _error');}else{$('.header_status_text').text('通信エラー');$('.header_status').addClass('_show _error');}$(this).val($(this).data('choice'));}).always(function(a){setTimeout(function(){$('.header_status_text').text('');$('.header_status').removeClass('_show _success _error');},2000);});});$('#delete_button').on('click',function(){if(!window.confirm('削除してよろしいですか？'))return false;});if($('#input_image_add_button').length!=0){$('#input_image_add_button').on('click',function(){$('#upload').click();});$('#upload').on('change',function(a){var b=$('#input_image_add_button').attr('data-lang');var c=$('#input_image_add_button').attr('data-refresh_href');$('#image_upload').off('submit');$('#image_upload').on('submit',function(c){c.stopPropagation();c.preventDefault();var d=new FormData();$.each(a.target.files,function(a,b){d.append('image_file',b);});$('#loading').show();$.ajax({type:'POST',url:'/'+b+'/api/images/add',cache:false,data:d,processData:false,contentType:false}).done(function(a){var b=a.image_url;var c=b.replace('/image/upload/','/image/upload/w_250,h_250,c_pad,b_white/');$('#input_image_add').val(b);$('#image_url').attr('src',c);if($('#empty_image').length===1){$('#empty_image').remove();$('#input_image_list_add_button').click();}}).fail(function(a){$('.header_status_text').text('通信エラー');$('.header_status').addClass('_show _error');}).always(function(){$('input[name="image_file"]').val('');$('#loading').hide();setTimeout(function(){$('.header_status_text').text('');$('.header_status').removeClass('_show _success _error');},2000);});});$('#image_upload').trigger('submit');if(c)window.location.href=c;});}function a(a){if(!a)return a;if(a.length>40){a=a.substr(0,40);a+'...';}return a;}$('#input_image_list_add_button').on('click',function(){if($('#image_list').find('li').length!==0)return false;if($('#empty_image').length===1)return false;var b=$(this).attr('data-lang');$('#image_list_block').show();$.ajax({type:'GET',url:'/'+b+'/api/images',cache:false}).done(function(c){$.each(c.images,function(b,c){$('#image_list').append('<li><a href="'+c.image_url+'" data-lity class="a_link">'+a(c.title)+'</a> <a href="javascript:;" class="choice_image"'+'data-image_url="'+c.image_url+'">選択する</a></li>');});if(c.total!==1&&c.total!=c.paged&&c.total!==0)$('#image_list').parent().append('<a href="javascript:;" class="a_link image_more_link"'+'data-paged="'+(c.paged+1)+'"'+'data-lang="'+b+'">さらに読み込む</a>');if(c.total===0)$('#image_list').parent().append('<p id="empty_image">画像は登録されていません。</p>');else $('#empty_image').remove();if(c.total===c.paged)$('#image_list').parent().find('.more_link').remove();}).fail(function(a){$('.header_status_text').text('通信エラー');$('.header_status').addClass('_show _error');}).always(function(){setTimeout(function(){$('.header_status_text').text('');$('.header_status').removeClass('_show _error');},2000);});});$(document).on('click','.image_more_link',function(){var b=$(this).attr('data-lang');var c=$(this).attr('data-paged');$.ajax({type:'GET',url:'/'+b+'/api/images/'+c,cache:false}).done(function(c){$.each(c.images,function(b,c){$('#image_list').append('<li><a href="'+c.image_url+'" data-lity class="a_link">'+a(c.title)+'</a> <a href="javascript:;" class="choice_image"'+'data-image_url="'+c.image_url+'">選択</a></li>');});if(c.total!==1&&c.total!=c.paged&&c.total!==0)$('#image_list').append('<li><a href="javascript:;" class="a_link image_more_link"'+'data-paged="'+(c.paged+1)+'"'+'data-lang="'+b+'">さらに読み込む</a></li>');if(c.total===c.paged)$('#image_list').find('.image_more_link').remove();}).fail(function(a){$('.header_status_text').text('通信エラー');$('.header_status').addClass('_show _error');}).always(function(){setTimeout(function(){$('.header_status_text').text('');$('.header_status').removeClass('_show _error');},2000);});});$(document).on('click','.choice_image',function(){var a=$(this).attr('data-image_url');var b=a.replace('/image/upload/','/image/upload/w_250,h_250,c_pad,b_white/');$('#input_image_add').val(a);$('#image_url').attr('src',b);});$('.image_delete_check').on('click',function(a){var b=$(this).attr('data-lang');var c=$(this).attr('data-image_id');var d=$(this).attr('data-href');$.ajax({type:'GET',url:'/'+b+'/api/images/delete/'+c,cache:false}).done(function(a){if(a.delete_flag===true)window.location.href=d;else{$('.header_status_text').text('投稿で使用中の画像です。');$('.header_status').addClass('_show _error');}}).fail(function(a){$('.header_status_text').text('通信エラー');$('.header_status').addClass('_show _error');}).always(function(){setTimeout(function(){$('.header_status_text').text('');$('.header_status').removeClass('_show _error');},2000);});});function b(b,c){$.ajax({type:'GET',url:'/'+c+'/api/titles/'+b,cache:false}).done(function(b){$.each(b.titles,function(b,c){var d=c.title;$('#titles_list').append('<li>'+a(d)+' <a href="javascript:;" class="a_link choice_list" data-add_id="'+c.id+'" data-post_title="'+a(d)+'" data-post_type="titles">選択</a></li>');});if(b.total!==1&&b.total!=b.paged&&b.total!==0)$('#titles_list').append('<li><a href="javascript:;" class="a_link title_more_link" data-paged="'+(b.paged+1)+'">さらに読み込む</a></li>');if(b.total===b.paged)$('#titles_list').find('.title_more_link').remove();}).fail(function(a){$('.header_status_text').text('通信エラー');$('.header_status').addClass('_show _error');}).always(function(){setTimeout(function(){$('.header_status_text').text('');$('.header_status').removeClass('_show _error');},2000);});}if($('#titles_list').length!=0){var c=$('#titles_list').attr('data-lang');b(1,c);}$(document).on('click','.title_more_link',function(){var a=$('#titles_list').attr('data-lang');var c=$(this).attr('data-paged');$(this).remove();b(c,a);});function d(b,c,d){$.ajax({type:'GET',url:'/'+c+'/api/videos/'+b,cache:false,data:{'post_id':d}}).done(function(b){$.each(b.videos,function(b,c){var d=c.title;$('#videos_list').append('<li>'+a(d)+' <a href="javascript:;" class="a_link choice_list" data-add_id="'+c.id+'" data-post_title="'+a(d)+'" data-post_type="videos">選択</a></li>');});if(b.total!==1&&b.total!==b.paged&&b.total!==0)$('#videos_list').append('<li><a href="javascript:;" class="a_link video_more_link" data-paged="'+(b.paged+1)+'">さらに読み込む</a></li>');if(b.total===b.paged)$('#videos_list').find('.video_more_link').remove();}).fail(function(a){$('.header_status_text').text('通信エラー');$('.header_status').addClass('_show _error');}).always(function(){setTimeout(function(){$('.header_status_text').text('');$('.header_status').removeClass('_show _error');},2000);});}if($('#videos_list').length!=0){var c=$('#videos_list').attr('data-lang');var e=$('#videos_list').attr('data-video_id');d(1,c,e);}$(document).on('click','.video_more_link',function(){var a=$('#videos_list').attr('data-lang');var b=$('#videos_list').attr('data-video_id');var c=$(this).attr('data-paged');$(this).remove();d(c,a,b);});function f(b,c){$.ajax({type:'GET',url:'/'+c+'/api/introductions/'+b,cache:false}).done(function(b){$.each(b.introductions,function(b,c){var d=c.name;$('#introductions_list').append('<li>'+a(d)+' <a href="javascript:;" class="a_link choice_list" data-add_id="'+c.id+'"'+'data-post_title="'+a(d)+'" data-post_type="introductions">選択</a></li>');});if(b.total!==1&&b.total!==b.paged&&b.total!==0)$('#introductions_list').append('<li><a href="javascript:;" class="a_link introduction_more_link" data-paged="'+(b.paged+1)+'">さらに読み込む</a></li>');if(b.total===b.paged)$('#introductions_list').find('.introduction_more_link').remove();}).fail(function(a){$('.header_status_text').text('通信エラー');$('.header_status').addClass('_show _error');}).always(function(){setTimeout(function(){$('.header_status_text').text('');$('.header_status').removeClass('_show _error');},2000);});}if($('#introductions_list').length!=0){var c=$('#introductions_list').attr('data-lang');f(1,c);}$(document).on('click','.introduction_more_link',function(){var a=$('#introductions_list').attr('data-lang');var b=$(this).attr('data-paged');$(this).remove();f(b,a);});function g(b,c){$.ajax({type:'GET',url:'/'+c+'/api/topics/'+b,cache:false}).done(function(b){$.each(b.topics,function(b,c){var d=c.title;$('#topics_list').append('<li>'+a(d)+' <a href="javascript:;" class="a_link choice_list" data-add_id="'+c.id+'" data-post_title="'+a(d)+'" data-post_type="topics">選択</a></li>');});if(b.total!==1&&b.total!==b.paged&&b.total!==0)$('#topics_list').append('<li><a href="javascript:;" class="a_link topic_more_link" data-paged="'+(b.paged+1)+'">さらに読み込む</a></li>');if(b.total===b.paged)$('#topics_list').find('.topic_more_link').remove();}).fail(function(a){$('.header_status_text').text('通信エラー');$('.header_status').addClass('_show _error');}).always(function(a){setTimeout(function(){$('.header_status_text').text('');$('.header_status').removeClass('_show _error');},2000);});}if($('#topics_list').length!=0){var c=$('#topics_list').attr('data-lang');g(1,c);}$(document).on('click','.topic_more_link',function(){var a=$('#topics_list').attr('data-lang');var b=$(this).attr('data-paged');$(this).remove();g(b,a);});function h(){$.ajax({type:'GET',url:'/api/groups',cache:false}).done(function(b){$.each(b.groups,function(b,c){$('#categories_list').append('<li>'+c.name+'</li>');$.each(c.categories,function(b,d){var e=d.name_ja+' / '+d.name_en;$('#categories_list').append('<li>'+a(e)+' <a href="javascript:;" class="a_link choice_list" data-group_id="group_'+c.id+'" data-add_id="'+d.id+'" data-post_title="'+a(e)+'" data-post_type="categories">選択</a></li>');});});}).fail(function(a){$('.header_status_text').text('通信エラー');$('.header_status').addClass('_show _error');}).always(function(){setTimeout(function(){$('.header_status_text').text('');$('.header_status').removeClass('_show _error');},2000);});}if($('#categories_list').length!=0)h();$(document).on('click','.choice_list',function(){var a=$(this).attr('data-add_id');var b=$(this).attr('data-post_type');var c=$(this).attr('data-post_title');var d=$(this).attr('data-group_id');if(d)var e=$('#'+d);else var e=$(this).parents('td').next().find('ul');if($('#'+b+'_'+a).length!=0)return false;e.append('<li><input type="checkbox" name="'+b+'" checked value="'+a+'" id="'+b+'_'+a+'"><label for="'+b+'_'+a+'">'+c+'</label></li>');});